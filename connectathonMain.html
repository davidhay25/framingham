<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Connectathon</title>
    <script src="js/libs/angular.min1-5.js"></script>
    <script src="js/libs/ui-bootstrap-tpls-2.0.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="stylesheet" type="text/css" href="css/angular-lightweight-markdown-editor.css"/>

    <script src="js/libs/ngStorage.min.js"></script>

    <script src="js/libs/angular-sanitize.js"></script>

    <!-- http://jtblin.github.io/angular-chart.js/ -->
    <script src="js/libs/Chart.min.js"></script>
    <script src="js/libs/angular-chart.js"></script>

    <script>
        angular.module("sampleApp",['ui.bootstrap','ngSanitize','ngStorage','chart.js',"angular-lightweight-markdown-editor"]).
        config(function($locationProvider) {
            $locationProvider.hashPrefix('!');
        });

        angular.module("sampleApp").config(['$compileProvider', function ($compileProvider) {

            $compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob):/);

        }]);

        window.onerror = function(message, url, linenumber) {
            alert("An unexpected error occurred: " + message + " on line " + linenumber + " for " + url);
        }

    </script>

    <style>


        /*
        .navbar-default {
            background-color: yellow;
            border-color: #E7E7E7;
        }

        */

        .markdown-editor {
            border: 1px solid #ccc;
            border-radius: 2px;
        }
        .trackScroll {
            height: 650px;
            overflow-y: scroll;
        }

        .pass {
            border : 1px solid #eeeeee;
            padding : 5px;
            display: inline-block;
            text-align : center;
            width: 50px;
            margin: 0px;
            /*margin-left : 10px;*/
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            background-color:green;
            color:white;
        }
        .fail {
            border : 1px solid #eeeeee;
            padding : 5px;
            display: inline-block;
            text-align : center;
            width: 50px;
            margin: 0px;
            /*margin-left : 10px;*/
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            background-color:red;
            color:white;

        }
        .partial {
            border : 1px solid #eeeeee;
            padding : 5px;
            display: inline-block;
            text-align : center;
            width: 50px;
            margin: 0px;
            /*margin-left : 10px;*/
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            background-color: #FFC200;
            color:white;

        }

        .note {
            border : 1px solid #eeeeee;
            padding : 5px;
            display: inline-block;
            text-align : center;
            width: 50px;
            margin: 0px;
            /*margin-left : 10px;*/
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            background-color:#6E94FF;
            color:white;

        }
    </style>

    <script src="js/libs/showdown.min.js"></script>
    <script src="js/libs/angular-lightweight-markdown-editor.min.js"></script>

    <script src="js/ecosystemCtl.js"></script>
    <script src="js/ecosystemSvc.js"></script>
    <script src="js/modalDialogSvc.js"></script>
    <script src="js/addServerToScenarioCtrl.js"></script>
    <script src="js/addClientToScenarioCtrl.js"></script>
    <script src="js/resultCtrl.js"></script>
    <script src="js/downloadCtrl.js"></script>
    <script src="js/addClientCtrl.js"></script>
    <script src="js/addServerCtrl.js"></script>
    <script src="js/editPersonCtrl.js"></script>
    <script src="js/ecoUtilitiesSvc.js"></script>
    <script src="js/editTrackCtrl.js"></script>
    <script src="js/filters.js"></script>
</head>
<body style="padding: 8px;padding-top: 80px" >

<div ng-app="sampleApp" ng-controller="ecosystemCtrl" class="container-fluid">

    <nav class="navbar navbar-default navbar-fixed-top" ng-style="navBarStyle" role="navigation">

        <div class="container-fluid row">
            <div class="col-md-6 col-sm-6">
                <a class="navbar-brand" href="#">

                    Connectathon Mananger: {{eventConfig.name}}
                </a>
            </div>

            <div class="col-md-3 col-sm-3">

            </div>

            <div class="col-md-2 col-sm-2">
                <div class="navbar-text">
                    <div class="row">
                        <div class="col-md-10 col-sm-10">
                            <input type="text" ng-model="input.currentUser"
                                   placeholder="Enter current user"
                                   typeahead-on-select = "userSelected($item, $model, $label, $event)"
                                   uib-typeahead="person.name for person in allPersons | filter:{name:$viewValue} | limitTo:8" class="form-control"/>

                        </div>
                        <div class="col-md-2 col-sm-2">
                            <i class="glyphicon glyphicon-remove-sign"
                               ng-show = "input.currentUser"
                               style="padding-top: 8px"
                               title="Clear user" ng-click="clearUser()">
                            </i>
                        </div>
                    </div>



                </div>
            </div>
            <div class="col-md-1 col-sm-1">
                <div class="navbar-text">

                    <button class="btn btn-primary" ng-click="refresh()">Refresh</button>

                </div>
            </div>



        </div>
    </nav>

    <div class="row">

        <div class="col-sm-12 col-md-12">

            <uib-tabset>

                <uib-tab heading="Track Descriptions">
                    <br/>



                    <div class="row">
                        <div class="col-sm-2 col-md-2">
                            <div class="trackScroll">
                                <ul class="list-group">
                                    <li ng-class="{'list-group-item':1,'listItemSelected':selectedTrack.id == track.id}"
                                        style="cursor: pointer"
                                        ng-repeat="track in tracks | orderBy: 'name' "
                                        ng-click="selectTrack(track)">
                                        {{track.name}}
                                    </li>
                                </ul>
                            </div>


                        </div>
                        <div class="col-sm-10 col-md-10" ng-show="selectedTrack">


                            <uib-tabset>
                                <uib-tab heading="Description">
                                    <br/>
                                    <!--
                                                                <a ng-click="editTrack(selectedTrack)">Edit</a>
                                    -->
                                    <div class="row">
                                        <div class="col-sm-2 col-md-2">

                                            <strong>Description</strong>
                                        </div>
                                        <div class="col-sm-9 col-md-9">
                                            <p ng-bind-html="selectedTrack.description | markDown"></p>
                                            <!--{{selectedTrack.description}}-->
                                        </div>
                                    </div>
                                    <br/>
                                    <div class="row">
                                        <div class="col-sm-2 col-md-2">
                                            <strong>Track Leads</strong>
                                        </div>
                                        <div class="col-sm-10 col-md-10">
                                            <ul class="list-unstyled">
                                                <li ng-repeat="lead in selectedTrack.leads">
                                                    {{lead.name}}
                                                    <div ng-show="contact.value" style="margin-left: 20px" ng-repeat="contact in lead.contact">
                                                        {{contact.type}}: {{contact.value}}
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <br/>
                                    <div class="row">
                                        <div class="col-sm-2 col-md-2">
                                            <strong>Wiki Page</strong>
                                        </div>
                                        <div class="col-sm-9 col-md-9">
                                            <a target="_blank" ng-href="{{selectedTrack.url}}">{{selectedTrack.url}}</a> (Opens in a new tab)
                                        </div>
                                    </div>
                                    <br/>


                                    <div class="row">
                                        <div class="col-sm-2 col-md-2">
                                            <strong>Registered Participants</strong>
                                        </div>
                                        <div class="col-sm-10 col-md-10">

                                            <div ng-show="selectedTrack.persons.length==0">
                                                No participants registered so far.
                                            </div>

                                            <div class="row">
                                                <div class="col-sm-4 col-md-4">
                                                    <ul>
                                                        <li style="cursor: pointer"
                                                            ng-repeat="person in selectedTrack.persons track by $index"
                                                            ng-click="input.selectedTrackPerson = person">
                                                            {{person.name}}
                                                        </li>
                                                    </ul>

                                                </div>
                                                <div class="col-sm-8 col-md-8">

                                                    <div class="row" ng-repeat="contact in input.selectedTrackPerson.contact">
                                                        <div class="col-sm-4 col-md-4">
                                                            <strong>{{contact.type}}</strong>
                                                        </div>
                                                        <div class="col-sm-8 col-md-8">
                                                            {{contact.value}}
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>

                                        </div>
                                    </div>


                                    <div class="row">
                                        <div class="col-sm-2 col-md-2">
                                            <strong>Watchers (Tracks of Interest)</strong>
                                        </div>
                                        <div class="col-sm-10 col-md-10">

                                            <div ng-show="selectedTrack.toi.length==0">
                                                No Watchers registered so far.
                                            </div>

                                            <div class="row">
                                                <div class="col-sm-4 col-md-4">
                                                    <ul>
                                                        <li
                                                            style="cursor: pointer"
                                                            ng-repeat="person in selectedTrack.toi track by $index"
                                                            ng-click="input.selectedTrackTOIPerson = person">
                                                            {{person.name}}
                                                        </li>
                                                    </ul>

                                                </div>
                                                <div class="col-sm-8 col-md-8">
                                                    {{input.selectedTrackTOIPerson.name}}
                                                    <div class="row" ng-repeat="contact in input.selectedTrackTOIPerson.contact">
                                                        <div class="col-sm-4 col-md-4">
                                                            <strong>{{contact.type}}</strong>
                                                        </div>
                                                        <div class="col-sm-8 col-md-8">
                                                            {{contact.value}}
                                                        </div>
                                                    </div>


                                                </div>
                                            </div>

                                        </div>
                                    </div>



                                    <div class="row">
                                        <div class="col-sm-2 col-md-2">
                                            <strong>Roles</strong>
                                        </div>
                                        <div class="col-sm-10 col-md-10">

                                            <div class="row">
                                                <div class="col-sm-4 col-md-4">
                                                    <ul class="list-group">
                                                        <li ng-class="{'list-group-item':1,'listItemSelected':selectedRole.id == role.id}"
                                                            style="cursor: pointer"
                                                            ng-repeat="role in selectedTrack.roles track by $index"
                                                            ng-click="selectRole(role)">
                                                            {{role.name}}
                                                        </li>
                                                    </ul>

                                                </div>
                                                <div class="col-sm-8 col-md-8">
                                                    <p ng-bind-html="selectedRole.description"></p>

                                                    <div ng-show="selectedRole.role == 'client'">
                                                        This role acts as a Client in a Client/Server test
                                                    </div>
                                                    <div ng-show="selectedRole.role == 'server'">
                                                        This role acts as a Server in a Client/Server test
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-2 col-md-2">
                                            <strong>Scenarios</strong>
                                        </div>
                                        <div class="col-sm-10 col-md-10">
                                            <div class="row">

                                                <div class="col-sm-4 col-md-4">
                                                    <ul class="list-group">
                                                        <li ng-class="{'list-group-item':1,'listItemSelected':selectedScenario.id == scenario.id}"
                                                            style="cursor: pointer"
                                                            ng-repeat="scenario in selectedTrack.scenarios track by $index"
                                                            ng-click="selectScenario(scenario)">
                                                            {{scenario.name}}
                                                        </li>
                                                    </ul>

                                                </div>


                                                <div class="col-sm-8 col-md-8" ng-show="selectedScenario">
                                                    <p ng-bind-html="selectedScenario.description"></p>

                                                    <div class="row" ng-show="selectedScenario.action">
                                                        <div class="col-sm-3 col-md-3">
                                                            Action
                                                        </div>
                                                        <div class="col-sm-9 col-md-9">
                                                            {{selectedScenario.action}}
                                                        </div>
                                                    </div>

                                                    <div class="row" ng-show="selectedScenario.precondition">
                                                        <div class="col-sm-3 col-md-3">
                                                            Precondition
                                                        </div>
                                                        <div class="col-sm-9 col-md-9">
                                                            {{selectedScenario.precondition}}
                                                        </div>
                                                    </div>
                                                    <div class="row"ng-show="selectedScenario.steps.length > 0">
                                                        <div class="col-sm-3 col-md-3">
                                                            Steps
                                                        </div>
                                                        <div class="col-sm-9 col-md-9">
                                                            <ol>
                                                                <li ng-repeat="step in selectedScenario.steps">
                                                                    {{step}}
                                                                </li>
                                                            </ol>
                                                        </div>
                                                    </div>
                                                    <div class="row" ng-show="selectedScenario.success">
                                                        <div class="col-sm-3 col-md-3">
                                                            Success
                                                        </div>
                                                        <div class="col-sm-9 col-md-9">
                                                            {{selectedScenario.success}}
                                                        </div>
                                                    </div>
                                                    <div class="row" ng-show="selectedScenario.bonus.length > 0">
                                                        <div class="col-sm-3 col-md-3">
                                                            Bonus
                                                        </div>
                                                        <div class="col-sm-9 col-md-9">
                                                            <ul class="list-unstyled">
                                                                <li ng-repeat="bonus in selectedScenario.bonus">
                                                                    {{bonus}}
                                                                </li>
                                                            </ul>

                                                        </div>
                                                    </div>

                                                    <hr style="height: 8px"/>

                                                    <div class="row">
                                                        <div class="col-sm-3 col-md-3">
                                                            Configured Clients
                                                        </div>
                                                        <div class="col-sm-9 col-md-9">

                                                            <ul>
                                                                <li ng-repeat="clientRole in selectedScenario.clients">
                                                                    {{clientRole.client.name}} ({{clientRole.role.name}})
                                                                </li>
                                                            </ul>

                                                            <button class="btn btn-link pull-right"
                                                                    ng-click="addClientToScenario(selectedScenario)">Add Client</button>

                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-sm-3 col-md-3">
                                                            Configured Servers
                                                        </div>
                                                        <div class="col-sm-9 col-md-9">
                                                            <ul >
                                                                <li ng-repeat="serverRole in selectedScenario.servers">
                                                                    {{serverRole.server.name}} ({{serverRole.role.name}})
                                                                </li>
                                                            </ul>
                                                            <button class="btn btn-link  pull-right" ng-click="addServerToScenario(selectedScenario)">Add Server</button>

                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </uib-tab>
                                <uib-tab heading="Report">
                                    <br/>
                                    <div class="row">
                                        <div class="col-md-6 col-sm-6">
                                            <div>There are {{selectedTrack.persons.length}} participants
                                            and {{selectedTrack.toi.length}} watchers.</div>

                                                <div>There are {{selectedTrackReport.uniqueServers.length}} unique Servers associated
                                                with scenarios in this track.
                                                    <span ng-show="selectedTrackReport.uniqueServers.length"> These are: </span></div>
                                            <br/>
                                            <ul class="list-unstyled" style="margin-left: 70px">
                                                <li ng-repeat="serverRole in selectedTrackReport.uniqueServers">
                                                    {{serverRole.server.name}} ({{serverRole.server.contact[0].name}})
                                                </li>
                                            </ul>
                                            <div>There are {{selectedTrackReport.uniqueClients.length}} unique Clients associated
                                                with scenarios in this track.
                                                <span ng-show="selectedTrackReport.uniqueClients.length"> These are: </span></div>
                                            <br/>
                                            <ul class="list-unstyled" style="margin-left: 70px">
                                                <li ng-repeat="clientRole in selectedTrackReport.uniqueClients">
                                                    {{clientRole.client.name}} ({{clientRole.client.contact[0].name}})
                                                </li>
                                            </ul>


                                            <br/>
                                            <div ng-show="selectedTrackReport.total ==0">There are no test results yet.</div>

                                            <div ng-show="selectedTrackReport.total >0">
                                                <div>There
                                                    <span ng-show="selectedTrackReport.total == 1">was 1 test report</span>
                                                    <span ng-show="selectedTrackReport.total >1">were {{selectedTrackReport.total}} test results</span>

                                                    reported. The test results broke down as follows:</div>

                                                <br/>

                                                <div style="margin-left: 100px">
                                                    <table>
                                                        <tr>
                                                            <th>Result</th><th>Count</th><th>%</th>
                                                        </tr>
                                                        <tr ng-repeat = "(k,v) in selectedTrackReport.resultTotals">
                                                            <td width="80px">{{k}}</td>
                                                            <td width="60px">{{v}}</td>
                                                            <td width="60px">{{(v/selectedTrackReport.total)*100 | number:0}}%</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-md-6 col-sm-6">
                                            <strong>Result notes</strong>
                                            <div ng-repeat="note in selectedTrackReport.notes">
                                                <div class="rounded-box">
                                                    <div class="row"
                                                         style="background-color: lightgoldenrodyellow; margin: 2px">
                                                        <div class="col-sm-6 col-md-6">
                                                            {{note.asserter.name}}
                                                        </div>
                                                        <div class="col-sm-6 col-md-6">
                                                            <div class="pull-right">{{note.date | date:'EEE hh:mm a'}}</div>

                                                        </div>
                                                    </div>

                                                    <hr style="margin: 2px"/>
                                                    <div class="row">
                                                        <div class="col-sm-12 col-md-12">
                                                            <div style="margin-left: 25px">{{note.note}}</div>
                                                        </div>

                                                    </div>
                                                    <hr style="margin: 2px"/>

                                                    <div class="row"
                                                         style="margin: 2px">
                                                        <div class="col-sm-6 col-md-6">
                                                            <div style="margin-top: 10px">
                                                                <strong >{{note.scenarioName}}</strong>
                                                            </div>

                                                        </div>
                                                        <div class="col-sm-6 col-md-6">
                                                            <div class="pull-right">
                                                                <div ng-class="note.text ">{{note.text}}</div>
                                                            </div>


                                                        </div>
                                                    </div>



                                                   <!-- {{note}}-->

                                                </div>
                                            </div>
                                        </div>
                                    </div>







                                </uib-tab>
                            </uib-tabset>



                        </div>
                    </div>

                </uib-tab>

                <uib-tab heading="People">
                    <br/>
                    <!--
                    <div>
                        <button class="btn btn-link pull-right" ng-click="editPerson()">New Person</button>
                    </div>
-->
                    <div class="row">
                        <div class="col-sm-6 col-md-6">
                            <div class="trackScroll">
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        <input class="form-control" ng-model="input.personNameFilter"
                                               placeholder="Enter string to filter list by (name & org)"/>
                                    </div>
                                </div>
                                <table class="table table-bordered">
                                    <tr><th>Name</th><th>Organization</th><th>Primary track</th><th>
                                        <button class="btn btn-link pull-right" ng-click="editPerson()">New Person</button></th></tr>
                                    <tr ng-repeat="person in allPersons" ng-show="canShowPerson(person,input.personNameFilter)">
                                        <td><button class="btn btn-link" ng-click="selectPerson(person)">{{person.name}}</button> </td>
                                        <td>{{person.organization}}</td>
                                        <td>
                                           {{person.primaryTrack.name}}
                                        </td>
                                        <td><button class="btn btn-link" ng-click="editPerson(person)">Edit</button> </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-6" ng-show="personSummary">


                            <div class="banner">{{personSummary.person.name}}</div>

                            <h4>Contacts</h4>
                            <div ng-repeat="contact in personSummary.person.contact">
                                {{contact.type}}: {{contact.value}}
                            </div>

                            <h4>Primary Track</h4>
                            <div ng-hide="personSummary.primaryTrack">No primary track selected.</div>
                            <div ng-show="personSummary.primaryTrack">{{personSummary.primaryTrack.name}}</div>

                            <h4>Tracks of interest</h4>
                            <div ng-hide="personSummary.toi.length > 0">No Tracks of Interest selected.</div>
                            <div ng-show="personSummary.toi.length > 0">
                                <ul>
                                    <li ng-repeat="track in personSummary.toi">
                                        {{track.name}}
                                    </li>
                                </ul>


                            </div>

                            <h4>Clients</h4>
                            <div ng-show="personSummary.clients.length == 0">No clients for this user.</div>
                            <table class="table table-bordered" ng-show="personSummary.clients.length > 0">
                                <tr><th>Name</th><th>Description</th><th></th></tr>
                                <tr ng-repeat = "client in personSummary.clients">
                                    <td>{{client.name}}</td>
                                    <td>{{client.description}}</td>
                                    <td><button class="btn btn-link" ng-click="editClient(client)">Edit</button> </td>
                                </tr>
                            </table>

                            <h4>Servers</h4>
                            <div ng-show="personSummary.servers.length == 0">No servers for this user.</div>
                            <table class="table table-bordered" ng-show="personSummary.servers.length > 0">
                                <tr><th>Name</th><th>Description</th><th></th></tr>
                                <tr ng-repeat = "server in personSummary.servers">
                                    <td>{{server.name}}</td>
                                    <td>{{server.description}}</td>
                                    <td><button class="btn btn-link" ng-click="editServer(server)">Edit</button> </td>
                                </tr>
                            </table>

                            <h4>Scenarios registered for (as Client or Server)</h4>
                            <div ng-show="personSummary.scenarios.length == 0">None yet.</div>
                            <table class="table table-bordered" ng-show="personSummary.scenarios.length > 0">
                                <tr><th>Track</th><th>Scenario</th><th>Client/Server</th><th>App (Role)</th></tr>
                                <tr ng-repeat = "scenario in personSummary.scenarios">
                                    <td>{{scenario.track.name}}</td>
                                    <td>{{scenario.scenario.name}}</td>
                                    <td>{{scenario.systemRole}}</td>

                                    <td>
                                        {{scenario.clientRole.client.name}} ({{scenario.clientRole.role.name}})
                                    </td>
                                    <td></td>

                                </tr>
                            </table>



                            <h4>Asserted results</h4>
                            <div ng-show="personSummary.results.length == 0">None yet.</div>
                            <table class="table table-bordered" ng-show="personSummary.results.length > 0">
                                <tr><th>Type<th>Track</th></th><th>Scenario</th><th>Client</th><th>Server</th><th>Result</th><th>Note</th></tr>
                                <tr ng-repeat = "result in personSummary.results">
                                    <td>{{result.type}}</td>
                                    <td>{{result.track.name}}</td>
                                    <td>{{result.scenario.name}}</td>
                                    <td><div ng-show="result.client">{{result.client.client.name}} ({{result.client.role.name}})</div></td>
                                    <td><div ng-show="result.server">{{result.server.server.name}} ({{result.server.role.name}})</div></td>
                                    <td>{{result.text}}</td>
                                    <td>{{result.note}}</td>
                                </tr>
                            </table>

<!--
                            <pre>{{personSummary | json}}</pre>
                            -->
                        </div>
                    </div>




                </uib-tab>

                <uib-tab heading="Clients">
                    <br/>
                    <div>
                        <button class="btn btn-link pull-right" ng-click="editClient()">New Client</button>
                    </div>
                    <table class="table table-bordered">
                        <tr><th>Name</th><th>Description</th><th>Contacts</th><th>Track / Scenario / Role (from Testing)

                        </th><th></th><th></th></tr>
                        <tr ng-repeat="clnt in allClients">
                            <td>{{clnt.name}}</td>
                            <td>{{clnt.description}}</td>
                            <td>
                                <div ng-repeat = "person in clnt.contact">
                                    {{person.name}}
                                    <span ng-repeat="contact in person.contact">
                                        {{contact.type}}: {{contact.value}}
                                    </span>
                                </div>
                            </td>
                            <td>
                                <div ng-repeat="scenarioName in getScenariosForClient(clnt) track by $index">
                                    {{scenarioName}}
                                </div>
                            </td>
                            <td>
                                <div ng-show="clnt.url">
                                    <a class="btn btn-link" ng-href="{{clnt.url}}" target="blank">Invoke</a>
                                </div>

                            </td>
                            <td>
                                <button class="btn btn-link" ng-click="editClient(clnt)">Edit</button>


                            </td>
                        </tr>
                    </table>


                </uib-tab>

                <uib-tab heading="Servers">
                    <br/>

                    <uib-tabset>
                        <uib-tab heading="Connectathon">
                            <div>
                                <button class="btn btn-link pull-right" ng-click="editServer()">New Server</button>
                            </div>
                            <table class="table table-bordered">
                                <tr><th>Name</th><th>Url</th><th>Version</th><th>Description</th><th>Contacts</th>
                                    <th>Track / Scenario / Role (from Testing)</th>
                                    <th  uib-popover="CDS=CDS hooks, SM = SMART, mouseover badge for details"
                                         popover-placement="top"
                                         popover-append-to-body = true
                                         popover-trigger="'mouseenter'">Flags</th>
                                    <th></th></tr>
                                <tr ng-repeat="svr in allServers">
                                    <td>{{svr.name}}</td>
                                    <td>{{svr.address | showUrlMaxLength : 50}}</td>
                                    <td>{{svr.fhirVersion}}</td>
                                    <td>
                                        <div uib-popover="{{svr.description}}"
                                             popover-placement="right"
                                             popover-append-to-body = true
                                             popover-trigger="'mouseenter'">

                                            {{getSvrDescription(svr)}}

                                        </div>

                                        <!--
                                    <div ng-repeat="hook in svr.allHooks.services"
                                         uib-popover="{{hook.description}}"
                                         popover-placement="top"
                                         popover-append-to-body = true
                                         popover-trigger="'mouseenter'">
                                        hook:{{hook.hook}} ({{hook.id}})
                                    </div>
                                        -->


                                    </td>
                                    <td>
                                        <div ng-repeat = "person in svr.contact">
                                            {{person.name}}
                                            <span ng-repeat="contact in person.contact">
                                                {{contact.type}}: {{contact.value}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div ng-repeat="scenarioName in getScenariosForServer(svr) track by $index">
                                            {{scenarioName }}
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge" ng-show="svr.allHooks.services.length > 0"
                                              uib-popover-html=showHooksSummary(svr)
                                              popover-placement="left"
                                              popover-trigger="'mouseenter'"
                                        >CDS</span>
                                        <span class="badge" ng-show="svr.SMART.authorize">SM</span>
                                    </td>

                                    <td><button class="btn btn-link" ng-click="editServer(svr)">Edit</button> </td>
                                </tr>
                            </table>

                        </uib-tab>
                        <uib-tab heading="Ecosystem">
                            <div class="banner">Locate servers by ecosystem role (rather than Scenario role) - Experimental</div>

                            <div class="row">
                                <div class="col-sm-2 col-md-2">
                                    <ul class="list-group">
                                        <li style="cursor: pointer"
                                            ng-class="{'list-group-item':true}"
                                            ng-click="selectServerRole(server)"
                                            ng-repeat="server in eventConfig.serverRoles">
                                            {{server.display}}

                                            <span ng-show="serverRoleSummary[server.code].servers.length > 0"
                                                  class="badge">{{serverRoleSummary[server.code].servers.length}}
                                            </span>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-sm-3 col-md-3">
                                    <div ng-show="serversWithServerRole.length == 0">No servers in this role...</div>
                                    <ul class="list-group">
                                        <li  style="cursor: pointer"
                                             ng-class="{'list-group-item':true}"
                                            ng-click="selectServerWithServerRole(svr)"
                                            ng-repeat="svr in serversWithServerRole">
                                            {{svr.name}}
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-sm-3 col-md-3">
                                    <table ng-show="selectedServer" class="table table-bordered">
                                        <tr><td>Name</td><td>{{selectedServer.name}}</td></tr>
                                        <tr><td>Description</td><td>{{selectedServer.description}}</td></tr>
                                        <tr><td>Url</td><td>{{selectedServer.address}}</td></tr>
                                        <tr><td>Contact</td><td>
                                            <div ng-repeat = "person in selectedServer.contact">
                                                {{person.name}}
                                                <span ng-repeat="contact in person.contact">
                                                {{contact.type}}: {{contact.value}}
                                            </span>
                                            </div>
                                        </td></tr>
                                    </table>


                                    <table ng-show="selectedServer" class="table table-bordered">
                                        <tr><th>Resource type</th><th>Capabilities</th></tr>
                                        <tr ng-repeat="type in selectedServer.serverDetails.types">
                                            <td>{{type.type}}</td>
                                            <td>{{type.cap}}</td>
                                        </tr>
                                    </table>
                                    <!--
                                    <pre>{{selectedServer | json}}</pre>
                                    -->
                                </div>
                            </div>



                        </uib-tab>
                    </uib-tabset>



                </uib-tab>

                <uib-tab heading="Testing">
                    <br/>

                    <div class="row">
                        <div class="col-sm-2 col-md-2">
                            <div class="trackScroll">
                                <ul class="list-group">
                                    <li ng-class="{'list-group-item':1,'listItemSelected':selectedTrack.id == track.id}" style="cursor: pointer"
                                        ng-repeat="track in tracks"
                                        ng-click="selectTrack(track)">
                                        {{track.name}}
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-sm-10 col-md-10">
                            <uib-tabset>
                                <uib-tab heading="Client/Server">
                                    <br/>
                                    <p class="banner">This is used when a scenario only uses 2 participants - a client and a server</p>
                                    <div ng-repeat="scenario in selectedTrack.scenarios track by $index">

                                        <div class="banner" style="height: 40px">{{scenario.name}}

                                            <span class="pull-left">
                                    <button class="btn btn-link" ng-click="addClientToScenario(scenario)">Add Client</button>
                                </span>

                                            <span class="pull-right">
                                    <button class="btn btn-link" ng-click="addServerToScenario(scenario)">Add Server</button>
                                </span>

                                        </div>
                                        <!--
                                                                        {{scenario.clients.length}} {{scenario.servers.length}}
                                                                        <div ng-show="! scenario.clients && !scenario.servers">
                                                                            <em>You need to add at least one server and one client to record test results</em>
                                                                        </div>

                                                                        <div ng-show="scenario.clients.length == 0 && scenario.servers.length > 0">
                                                                            <em>You need to add at least one client as well to record test results</em>
                                                                        </div>

                                                                        <div ng-show="scenario.servers.length ==0 && scenario.clients.length == 0">
                                                                            <em>You need to add at least one server as well to record test results</em>
                                                                        </div>
                                        -->
                                        <div class="row">
                                            <div class="col-sm-12 col-md-12">


                                                <table class="table table-bordered">
                                                    <tr>
                                                        <td width="150px"  >
                                                            <!--
                                                            <button class="btn btn-link" ng-click="addClientToScenario(scenario)">Add Client</button>
                                                            -->
                                                        </td>
                                                        <th ng-repeat="server in scenario.servers">
                                                            {{server.server.name}}
                                                            <div><em>({{server.role.name}})
                                                                <i class="clickable glyphicon glyphicon-remove-sign"
                                                                   title="Remove server" ng-click="removeServerFromScenario(scenario,server)">
                                                                </i>

                                                            </em></div>
                                                        </th>
                                                    </tr>

                                                    <tr ng-repeat="client in scenario.clients">
                                                        <td ><strong>
                                                            {{client.client.name}}
                                                            <div><em>({{client.role.name}})</em>
                                                                <i class="clickable glyphicon glyphicon-remove-sign"
                                                                   title="Remove client" ng-click="removeClientFromScenario(scenario,client)">
                                                                </i>
                                                            </div>
                                                        </strong>
                                                        </td>
                                                        <td ng-repeat="server in scenario.servers">
                                                            <a href="#" ng-click="addTestResult(selectedTrack,scenario,client,server)">

                                                                <span uib-popover-html=showTestResultNote(scenario,client,server)
                                                                      popover-placement="left"
                                                                      popover-trigger="'mouseenter'">
                                                                    <p ng-bind-html="showTestResult(scenario,client,server)"></p>
                                                                </span>


                                                            </a>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                            <!--
                                            <div class="col-sm-2 col-md-2">

                                                <button class="btn btn-link" ng-click="addServerToScenario(scenario)">Add Server</button>

                                            </div>
                                            -->
                                        </div>
                                        <!--
                                        <pre>{{scenario | json}}</pre>
        -->

                                    </div>


                                </uib-tab>

                                <uib-tab heading="Comment against Scenario (Direct)">
                                    <br/>
                                    <p class="banner">This allows a result to be recorded directly against a scenario</p>
                                    <div class="row">

                                        <div class="col-md-3 col-sm-3">
                                            <ul class="list-group">
                                                <li ng-class="{'list-group-item':1,
                                                    'listItemSelected':selectedScenarioDirect.id == scenario.id}"
                                                    style="cursor: pointer"
                                                    ng-repeat="scenario in selectedTrack.scenarios"
                                                    ng-click="selectScenarioDirect(scenario)">
                                                    {{scenario.name}}

                                                </li>
                                            </ul>

                                        </div>
                                        <div class="col-md-9 col-sm-9">
                                            <div ng-show="selectedScenarioDirect">


                                                <table class="table table-bordered">
                                                    <tr>
                                                        <th>Type</th><th>Asserter</th><th>Result</th>
                                                        <th>Note</th><th>Trackers</th>
                                                    </tr>
                                                    <tr ng-repeat="(key,result) in ecosystemSvc.getAllResults(null,selectedScenarioDirect)">
                                                        <td>{{result.type}}</td>
                                                        <td>{{result.asserter.name}}</td>
                                                        <td>{{result.text}}</td>

                                                        <td>{{result.note}}</td>
                                                        <td>
                                                            <div ng-repeat="tracker in result.trackers">
                                                                {{tracker.url}}
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <a href="#" ng-click="editTestResult(result)">edit</a>
                                                        </td>


                                                    </tr>
                                                </table>




                                                <a href="#" ng-click="addTestResult(selectedTrack,selectedScenarioDirect,null,null)">Add new result</a>
                                            </div>
                                        </div>

                                    </div>

                                </uib-tab>

                            </uib-tabset>



                        </div>

                    </div>

                </uib-tab>


                <uib-tab heading="Test Results">
                    <br/>

                    <uib-tabset>

                        <uib-tab heading="All tests">
                            <br/>


                            <button class="btn btn-link pull-right" ng-click="download('results')">Download results</button>

                            <table class="table table-bordered">
                                <tr>
                                    <th>Track</th><th>Scenario</th><th>Participants</th><th>Asserter</th><th>Result</th>
                                    <th>Note</th><th>Trackers</th>
                                </tr>
                                <tr ng-repeat="(key,result) in ecosystemSvc.getAllResults()">

                                    <td>{{result.track.name}}</td>
                                    <td>{{result.scenario.name}}</td>
                                    <td>
                                        <div ng-show="result.client">Client: {{result.client.client.name}}
                                            ({{result.client.role.name}})
                                        </div>
                                        <div ng-show="result.server">Server: {{result.server.server.name}}
                                            ({{result.server.role.name}})
                                        </div>
                                        <!--
                                        <div ng-repeat="part in result.participants">
                                            {{part.systemRole}}:  {{part.participant.name}} ({{part.role.name}})
                                        </div>
                                        -->
                                    </td>
                                    <td>{{result.asserter.name}}</td>
                                    <td>{{result.text}}</td>

                                    <td>{{result.note}}</td>
                                    <td>
                                        <div ng-repeat="tracker in result.trackers">
                                            {{tracker.url}}
                                        </div>
                                    </td>
                                    <!--<td>{{key}}</td>-->

                                </tr>
                            </table>


                        </uib-tab>


                        <uib-tab heading="Analysis by track">
                            <br/>
                            <div class="row">
                                <div class="col-md-3 col-sm-3">
                                    <div class="trackScroll">
                                    <ul class="list-group">
                                        <li ng-class="{'list-group-item':1,
                                            'listItemSelected':selectedTrackSummary.id == track.id}" style="cursor: pointer"
                                            ng-repeat="track in tracks"
                                            ng-click="selectTrackResults(track)">

                                             <span class="pull-right badge"
                                                   ng-show="track.resultTotals.pass || track.resultTotals.fail || track.resultTotals.partial || track.resultTotals.note"
                                                   uib-popover="{{track.resultTotals.pass}} Pass / {{track.resultTotals.fail}} Fail / {{track.resultTotals.partial}} Partial / {{track.resultTotals.note}} Note"
                                                   popover-placement="top"
                                                   popover-append-to-body = true
                                                   popover-trigger="'mouseenter'">

                                                    {{track.resultTotals.pass}} /
                                                    {{track.resultTotals.fail}} /
                                                    {{track.resultTotals.partial}} /
                                                    {{track.resultTotals.note}}
                                                </span>
                                            <div>{{track.name}}</div>

                                            <div>

                                            </div>



                                        </li>
                                    </ul>
                                    </div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <uib-tabset>
                                        <uib-tab heading="All scenarios summary">
                                            <br/>
                                            <canvas id="bar" class="chart chart-bar" chart-options="barOptions"
                                                    chart-data="barData" chart-labels="barLabels" chart-series="barSeries">
                                            </canvas>
                                        </uib-tab>
                                        <uib-tab heading="Summary by Scenario">
                                            <br/>
                                            <div class="row">

                                                <div class="col-md-4 col-sm-4">
                                                    <ul class="list-group">
                                                        <li ng-class="{'list-group-item':1,'listItemSelected':selectedScenarioSummary.id == scenario.id}"
                                                            style="cursor: pointer"
                                                            ng-repeat="scenario in selectedTrackSummary.scenarios"
                                                            ng-click="selectScenarioResults(scenario)">
                                                            {{scenario.name}}
                                                            <span class="pull-right" ng-show="resultsSummary.scenario[scenario.name].total > 0">
                                                                <span class=" badge">
                                                                    {{resultsSummary.scenario[scenario.name].total}}
                                                                </span>

                                                                <span class=" badge">

                                                                    {{resultsSummary.scenario[scenario.name].pass}} /
                                                                    {{resultsSummary.scenario[scenario.name].fail}} /
                                                                    {{resultsSummary.scenario[scenario.name].partial}} /
                                                                    {{resultsSummary.scenario[scenario.name].note}}
                                                                </span>
                                                            </span>



                                                        </li>
                                                    </ul>



                                                </div>
                                                <div class="col-md-8 col-sm-8">
                                                    <canvas id="pie" class="chart chart-pie"
                                                            chart-data="chartData" chart-labels="chartLabels" chart-options="chartOptions" chart-colors="chartColors">
                                                    </canvas>




                                                </div>





                                            </div>
                                        </uib-tab>
                                        <uib-tab heading="Details all scenarios this track">

                                            <br/>


                                            <button class="btn btn-link pull-right"
                                                    ng-click="download('results',selectedTrackSummary)">Download results</button>

                                            <table class="table table-bordered">
                                                <tr>
                                                    <th>Type</th><th>Scenario</th><th>Participants</th><th>Asserter</th><th>Result</th>
                                                    <th>Note</th><th>Trackers</th>
                                                </tr>
                                                <tr ng-repeat="(key,result) in ecosystemSvc.getAllResults(selectedTrackSummary)">

                                                    <td>{{result.type}}</td>
                                                    <td>{{result.scenario.name}}</td>
                                                    <td>
                                                        <div ng-show="result.client">Client: {{result.client.client.name}}
                                                            ({{result.client.role.name}})
                                                        </div>
                                                        <div ng-show="result.server">Server: {{result.server.server.name}}
                                                            ({{result.server.role.name}})
                                                        </div>
                                                        <!--
                                                        <div ng-repeat="part in result.participants">
                                                            {{part.systemRole}}:  {{part.participant.name}} ({{part.role.name}})
                                                        </div>
                                                        -->
                                                    </td>
                                                    <td>{{result.asserter.name}}</td>
                                                    <td>{{result.text}}</td>

                                                    <td>{{result.note}}</td>
                                                    <td>
                                                        <div ng-repeat="tracker in result.trackers">
                                                            {{tracker.url}}
                                                        </div>
                                                    </td>
                                                    <!--<td>{{key}}</td>-->

                                                </tr>
                                            </table>



                                        </uib-tab>
                                    </uib-tabset>
                                </div>




                            </div>


                        </uib-tab>


                    </uib-tabset>
<!--
                    <pre>{{ecosystemSvc.getAllResults() | json}}</pre>

-->
                </uib-tab>


                <uib-tab heading="Participation report" select="makeEventReport()">
                    <br/>
                    <div class="row">
                        <div class="col-md-6 col-sm-6">
                            <table class="table table-bordered">
                                <tr><th>Track</th><th>Primary</th><th>%</th><th>Watchers</th><th>%</th>
                                    <th>Results</th><th>%</th></tr>
                                <tr ng-repeat="track in eventReport.tracks">
                                    <td>{{track.name}}</td>
                                    <td width="70px"><span ng-show="track.persons">{{track.persons}}</span></td>
                                    <td width="70px"><span ng-show="track.persons">{{(track.persons/eventReport.totalPersons)*100 | number:0}}%</span></td>
                                    <td width="70px"><span ng-show="track.watchers">{{track.watchers}}</span></td>
                                    <td width="70px"><span ng-show="track.watchers">{{(track.watchers/eventReport.totalWatchers)*100 | number:0}}%</span></td>
                                    <td width="70px"><span ng-show="track.results.total">{{track.results.total}}</span></td>
                                    <td width="70px"><span ng-show="track.results.total">{{(track.results.total/eventReport.totalResults)*100 | number:0}}%</span></td>
                                </tr>
                                <tr><th></th><th>{{eventReport.totalPersons}}</th><th></th><th>{{eventReport.totalWatchers}}</th><th></th>
                                    <th></th><th>{{eventReport.totalResults}}</th></tr>
                            </table>
                        </div>
                        <div class="col-md-6 col-sm-6">

                        </div>
                    </div>



                </uib-tab>


                <uib-tab heading="Documentation">
                    <br/>

                    <iframe width="100%" height="900px" src="/artifacts/docs.html"></iframe>

                </uib-tab>



<!--
 ng-controller = "editTrackCtrl"

                <uib-tab heading="List">
                    <br/>
                    <select ng-model="input.filterRole" ng-change="setFilter()"
                            ng-options = "concept.display for concept in csAllRoles.concept"></select>

                    <table class="table table-bordered">
                        <tr><th>Name</th><th>Description</th><th>Role</th><th>Url</th><th>Auth Svr.</th><th>Notes</th><th>Tags</th></tr>
                        <tr ng-repeat="ep in endpoints" ng-show="canShow(ep)">
                            <td>{{ep.name}}</td>
                            <td>{{ep.description}}</td>
                            <td>{{ep.role}}</td>
                            <td>{{ep.url}}</td>
                            <td>{{ep.authz}}</td>
                            <td>
                                <div ng-repeat="note in ep.notes">
                                    {{note.text}}
                                </div>
                            </td>
                            <td>
                                <div ng-repeat="tag in ep.tags">
                                    {{tag}}
                                </div>
                                <a class='pull-right' href="#" ng-click="addTag(ep)">Add</a>
                            </td>
                        </tr>
                    </table>
                </uib-tab>
                <uib-tab heading="Graph">
                    <div class="row">
                        <div class="col-sm-4 col-md-4">

                        </div>
                        <div class="col-sm-4 col-md-4">

                        </div>
                    </div>
                </uib-tab>
                <uib-tab heading="json">
                    <pre>{{endpoints | json}}</pre>
                </uib-tab>

                -->
            </uib-tabset>

        </div>


    </div>

<!--
    <div><a class="btn btn-warning" ng-href="/auth?page=orion.html">Login as Clinician</a></div>
    <div><a class="btn btn-success" ng-href="/auth?page=patient.html">Login as Patient</a></div>

    <div class="row">
        <div class="col-sm-3 col-md-3">

        </div>
        <div class="col-sm-6 col-md-6">

        </div>
    </div>
-->


</div>

</body>
</html>