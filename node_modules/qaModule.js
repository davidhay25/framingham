
var db;
exports.setup = function(inDb,app) {
    db = inDb


    app.get('/qa/:url',function(req,res){
        console.log(req.params.url)
        var url = decodeURIComponent(req.params.url)
        db.collection("qaVS").find({url:url}).toArray(function(err,result){
            if (err) {
                res.send(err,500)
            } else {
                res.send(result)
            }
        })
    });

    //add a single comment. This is always a put as the comment can be updated
    app.put('/qa',function(req,res){
        var comment = req.body;
        comment.id = comment.id || 'id'+new Date().getTime();
        comment.date = comment.date || new Date();

        db.collection("qaVS").update({id:comment.id},comment,{upsert:true},function(err,result){
            if (err) {
                res.send(err,500)
            } else {
                res.send(result)
            }
        })
    });

};


