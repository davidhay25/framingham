<div>

    <style>
        #ccGraph {
            width: 100%;
            height: 200px;
            border: 1px solid lightgray;
        }

        input[type="radio"] {
            -ms-transform: scale(1.5); /* IE 9 */
            -webkit-transform: scale(1.5); /* Chrome, Safari, Opera */
            transform: scale(1.5);
        }



    </style>

    <div class="modal-header">

        <div class="row">
            <div class="col-md-8 col-sm-8">
                <h3 class="modal-title">{{row.path}} ({{datatype}})</h3>
                <!--   <h3 class="modal-title">{{resourceType}}.{{row.path}} ({{datatype}})</h3>-->
            </div>

            <div class="col-md-4 col-sm-4">
                <img ng-show='waiting' src="css/ajax_loader_blue_32.gif"/>
                <div class="pull-right">
                    <button class="btn btn-primary pull-right" ng-click="save()">Save</button>
                    <button class="btn btn-link pull-right" ng-click="$dismiss()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-body">


        <div>

            <div ng-show="datatype == 'UsageContext'">

                <div class="col-md-3 col-sm-3" ng-repeat = "option in expandedValueSet.expansion.contains">
                    <input type="radio" ng-model="input.dt.code" name="name" value="{{option.code}}"  />
                    <span title="{{option.system}}">{{option.display}}</span>
                </div>

            </div>

            <div ng-show="datatype == 'instant'">
                <div class="row">
                    <div class="col-md-7  col-sm-7 col-centered">
                        <div uib-datepicker ng-model="input.dt.instant" class="well well-sm"></div>
                    </div>
                </div>
            </div>

            <div ng-show="datatype == 'Narrative'">
                <!-- The status is 'additional' if any user text is entered...-->

                <div ng-show="input.narrativeStatus" class="row">
                    <div class="col-sm-2 col-md-2">
                        Narrative Status
                    </div>
                    <div class="col-sm-2 col-md-2">
                        <select ng-model="input.narrativeStatus" class="form-control">
                            <option value="generated">Generated</option>
                            <option value="extensions">Extensions</option>
                            <option value="additional">Additional</option>
                            <option value="empty">Empty</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-7  col-sm-7 col-centered">  <!--  -->
                        <textarea rows="8" class="form-control" ng-model="input.dt.narrative.div"></textarea>
                    </div>
                </div>

                <div class="row" ng-show="textFromTemplate">
                    <div class="col-sm-6 col-md-6">


                    </div>
                    <div class="col-sm-6 col-md-6">
                        <button class="btn btn-link" ng-click="pasteNarrative(textFromTemplate)">Paste from structured data</button>
                    </div>
                </div>

            </div>


            <div ng-show="datatype == 'Ratio'">
                <div class="row">
                    <div class="col-md-2  col-sm-2 ">
                        Numerator
                    </div>
                    <div class="col-md-2  col-sm-2 ">
                        <input placeholder = 'Value' type="text" class="form-control"
                               ng-model="input.dt.ratio.numerator.value"/>
                    </div>
                    <div class="col-md-2  col-sm-2 ">
                        <input placeholder = 'Units' type="text" class="form-control"
                               ng-model="input.dt.ratio.numerator.units"/>
                    </div>
                    <div class="col-md-4  col-sm-4 ">
                        <input placeholder = 'System' type="text" class="form-control"
                               ng-model="input.dt.ratio.numerator.system"/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-2  col-sm-2 ">
                        Denominator
                    </div>
                    <div class="col-md-2  col-sm-2 ">
                        <input placeholder = 'Value' type="text" class="form-control"
                               ng-model="input.dt.ratio.denominator.value"/>
                    </div>
                    <div class="col-md-2  col-sm-2 ">
                        <input placeholder = 'Units' type="text" class="form-control"
                               ng-model="input.dt.ratio.denominator.units"/>
                    </div>
                    <div class="col-md-4  col-sm-4 ">
                        <input placeholder = 'System' type="text" class="form-control"
                               ng-model="input.dt.ratio.denominator.system"/>
                    </div>
                </div>



            </div>




            <div ng-show="datatype == 'Attachment'">
                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        Title
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter title' type="text" class="form-control" ng-model="input.dt.attachment.title"/>
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        ContentType
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter content type' type="text" class="form-control" ng-model="input.dt.attachment.contentType"/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        Language
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter language' type="text" class="form-control" ng-model="input.dt.attachment.language"/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        Url
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter Url to content' type="text" class="form-control" ng-model="input.dt.attachment.url"/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        Size
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter size of the content' type="text" class="form-control" ng-model="input.dt.attachment.size"/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        Hash
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter content hash' type="text" class="form-control" ng-model="input.dt.attachment.hash"/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        Creation
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <div uib-datepicker ng-model="input.dt.attachment.creation" class="well well-sm"></div>

                    </div>
                </div>


            </div>

            <div ng-show="datatype == 'Quantity' || datatype == 'Age'">


                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        Value
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter quantity value (must be a number)' type="text" class="form-control" ng-model="input.dt.quantity.value"/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        System
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter units as string (eg mmHg)' type="text" class="form-control" ng-model="input.dt.quantity.unit"/>

                        <!--
                        <input type="text" ng-model="input.dt.quantity.units"
                               placeholder="{{vsDetails.id}} (minimum 2 characters)"
                               typeahead-min-length="2"
                               typeahead-wait-ms="1000"
                               typeahead-on-select="selectCCfromList($item, $model, $label)"
                               uib-typeahead="opt as opt.display for opt in vsLookup($viewValue,{id:'ucum-common'})"
                               class="form-control"/>

        -->
                    </div>
                </div>


            </div>

            <div ng-show="datatype == 'Dosage'">

                <div class="row" style="margin-bottom: 8px">
                    <div class="col-md-1  col-sm-1 ">
                        <div class="required">Text</div>
                    </div>
                    <div class="col-md-5  col-sm-5 ">
                        <textarea class="form-control" ng-model="input.dt.dosage.text"
                                  placeholder="Enter the textual description of the dose. This is displayed in the form."
                        ></textarea>
                    </div>
                    <div class="col-md-1  col-sm-1 ">
                        Patient Instructions
                    </div>
                    <div class="col-md-5  col-sm-5 ">
                        <textarea class="form-control" ng-model="input.dt.dosage.patientInstructions"></textarea>
                    </div>
                </div>


                <div class="row" style="margin-bottom: 8px">
                    <div class="col-md-1  col-sm-1 ">
                        Dose Quantity
                    </div>
                    <div class="col-md-5  col-sm-5 ">
                        <div class="row">
                            <div class="col-md-6  col-sm-6 ">
                                <input placeholder = 'Amount' type="text" class="form-control" ng-model="input.dt.dosage.dose.value"/>
                            </div>
                            <div class="col-md-6  col-sm-6 ">
                                <input placeholder = 'Unit' type="text" class="form-control" ng-model="input.dt.dosage.dose.unit"/>
                            </div>
                        </div>



                    </div>
                    <div class="col-md-1  col-sm-1 ">
                        Route
                    </div>
                    <div class="col-md-5  col-sm-5 ">
                        <input type="text" ng-model="input.dt.dosage.route.coding"
                               uib-popover="Search is 'starts with' - eg 'ora' or 'int'"
                               popover-placement="top"
                               popover-trigger="'mouseenter'"

                               typeahead-min-length="3"
                               typeahead-wait-ms="1000"
                               typeahead-on-select="selectCCfromList($item, $model, $label)"
                               uib-typeahead="opt as opt.display for opt in vsLookup($viewValue,routeCodes)"
                               class="form-control"/>
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-1  col-sm-1 ">
                        Selector
                    </div>
                    <div class="col-md-5  col-sm-5 ">

                        <div>

                            <div class="row" style="margin-bottom: 8px">

                                <div class="col-md-9 col-sm-9">
                                    <div class="col-md-3 col-sm-3"></div>

                                    <select class="form-control" ng-model="input.dosageTiming"
                                            ng-change="updateTimingDetails(input.dosageTiming)"
                                            ng-options="option.description for option in timingArray">
                                        <option></option>
                                    </select>
                                    <!--
                                            <input class="form-control" type="text" ng-model="input.dt.dosage.timingDescription.description"/>
                                    -->
                                </div>


                            </div>





                        </div>

                    </div>
                    <div class="col-md-1  col-sm-1 ">
                        As Needed
                    </div>
                    <div class="col-md-5  col-sm-5 ">
                        <input placeholder = 'Reason to take' type="text" class="form-control" ng-model="input.dt.dosage.prn.reason"/>
                    </div>

                </div>




                <hr/>

                <div class="row" style="margin-bottom: 8px">
                    <div class="col-md-1  col-sm-1 ">
                        Sequence
                    </div>
                    <div class="col-md-5  col-sm-5 ">
                        <input placeholder = 'Sequence (if multiple Dosages)' type="text" class="form-control" ng-model="input.dt.dosage.sequence"/>
                    </div>
                    <div class="col-md-1  col-sm-1 ">

                    </div>
                    <div class="col-md-5  col-sm-5 ">

                    </div>
                </div>


                <div class="row">
                    <div class="col-md-1  col-sm-1 ">
                        Timing
                    </div>
                    <div class="col-md-5  col-sm-5 ">
                        <div class="row">
                            <div class="col-md-3 col-sm-3">Duration</div>
                            <div class="col-md-3 col-sm-3">Units</div>
                            <div class="col-md-3 col-sm-3">freq</div>
                            <div class="col-md-3 col-sm-3">freqMax</div>
                        </div>

                        <div class="row">
                            <div class="col-md-3 col-sm-3">
                                <input type="text" class="form-control"  ng-model="input.dt.dosage.timing.duration"/>
                            </div>
                            <div class="col-md-3 col-sm-3">
                                <input type="text" class="form-control"  ng-model="input.dt.dosage.timing.units"/>
                            </div>
                            <div class="col-md-3 col-sm-3">
                                <input type="text" class="form-control"  ng-model="input.dt.dosage.timing.freq"/>
                            </div>
                            <div class="col-md-3 col-sm-3">
                                <input type="text" class="form-control"  ng-model="input.dt.dosage.timing.freq_max"/>
                            </div>

                        </div>

                        <div class="row">

                            <div class="col-md-3 col-sm-3">Period</div>
                            <div class="col-md-3 col-sm-3">PeriodMax</div>
                            <div class="col-md-3 col-sm-3">Units</div>
                            <div class="col-md-3 col-sm-3">When</div>

                        </div>

                        <div class="row">
                            <div class="col-md-3 col-sm-3">
                                <input type="text" class="form-control"  ng-model="input.dt.dosage.timing.period"/>
                            </div>
                            <div class="col-md-3 col-sm-3">
                                <input type="text" class="form-control"  ng-model="input.dt.dosage.timing.period_max"/>
                            </div>
                            <div class="col-md-3 col-sm-3">
                                <input type="text" class="form-control"  ng-model="input.dt.dosage.timing.period_units"/>
                            </div>
                            <div class="col-md-3 col-sm-3">
                                <input type="text" class="form-control" ng-model="input.dt.dosage.timing.when"/>
                            </div>

                        </div>

                    </div>
                    <div class="col-md-1  col-sm-1 ">

                    </div>
                    <div class="col-md-5  col-sm-5 ">

                    </div>
                </div>




            </div>

            <div ng-show="datatype == 'ContactPoint'">
                <div class="row">

                    <div class="col-md-3  col-sm-3 ">
                        <select class="form-control" ng-model="input.dt.contactpoint.use">
                            <option value="home">Home</option>
                            <option value="work">Work</option>
                            <option value="temp">Temp</option>
                            <option value="mobile">Mobile</option>

                        </select>

                    </div>
                    <div class="col-md-3  col-sm-3 ">
                        <select class="form-control" ng-model="input.dt.contactpoint.system">
                            <option value="phone">Phone</option>
                            <option value="fax">Fax</option>
                            <option value="email">Email</option>
                            <option value="pager">Pager</option>
                            <option value="url">Url</option>
                            <option value="other">Other</option>
                        </select>

                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter value' type="text" class="form-control" ng-model="input.dt.contactpoint.value"/>
                    </div>
                </div>

            </div>

            <div ng-show="datatype == 'Identifier'">


                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        Value
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter text value' type="text" class="form-control" ng-model="input.dt.identifier.value"/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3  col-sm-3 ">
                        System
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <input placeholder = 'Enter text value' type="text" class="form-control" ng-model="input.dt.identifier.system"/>
                    </div>
                </div>


            </div>

            <div ng-show="datatype == 'boolean'">

                <checkbox ng-model="input.dt.boolean"/>
                <br/>
                <div><em>Select the checkbox for True, de-select for False</em></div>

            </div>

            <div ng-show="datatype == 'Annotation'">
                <textarea  placeholder = 'Enter text' type="text" class="form-control" ng-model="input.dt.Annotation.text"></textarea>

            </div>

            <div ng-show="datatype == 'Period'">
                <div class="row">
                    <div class="col-md-6  col-sm-6 ">
                        <div uib-datepicker ng-model="input.dt.period.start" class="well well-sm"></div>
                    </div>
                    <div class="col-md-6  col-sm-6 ">
                        <div uib-datepicker ng-model="input.dt.period.end" class="well well-sm"></div>
                    </div>
                </div>

            </div>

            <div ng-show="datatype == 'date'">
                <div class="row">
                    <div class="col-md-7  col-sm-7 col-centered">
                        <div uib-datepicker ng-model="input.dt.date" class="well well-sm"></div>
                    </div>
                </div>

            </div>

            <div ng-show="datatype == 'dateTime'">
                <div class="row">
                    <div class="col-md-7  col-sm-7 ">
                        <div uib-datepicker ng-model="input.dt.date" class="well well-sm"></div>
                    </div>
                    <div class="col-md-5  col-sm-5 ">
                        <div uib-timepicker ng-model="input.dt.time"></div>
                    </div>

                </div>
                <div class="row">

                </div>


            </div>

            <div ng-show="datatype == 'integer' || datatype == 'positiveInt' || datatype == 'unsignedInt'">
                <input placeholder = 'Enter integer value' type="text" class="form-control" ng-model="input.dt.integer"/>
            </div>

            <div ng-show="datatype == 'decimal'">
                <input placeholder = 'Enter decimal value' type="text" class="form-control" ng-model="input.dt.integer"/>
            </div>

            <div ng-show="datatype == 'string'">

                <uib-tabset>
                    <uib-tab heading="Text">
                        <br/>
                        <input placeholder = 'Enter text value' type="text" class="form-control" ng-model="input.dt.string"/>
                    </uib-tab>

                    <uib-tab heading="Textarea">
                        <br/>
                        <textarea rows="8" class="form-control"ng-model="input.dt.string" >

                </textarea>

                    </uib-tab>
                </uib-tabset>


            </div>


            <div ng-show="datatype == 'markdown'">

                <textarea rows="8" class="form-control"ng-model="input.dt.markdown" >

                </textarea>
                <br/>
                <a href="https://guides.github.com/pdfs/markdown-cheatsheet-online.pdf" target="_blank">
                    MarkDown cheat sheet
                </a>
                <em>(Markdown is a way to format text with bullets, headings and test formatting by putting specific characters in the text)</em>


            </div>

            <div ng-show="datatype == 'uri'">
                <input placeholder = 'Enter value of uri' type="text" class="form-control" ng-model="input.dt.uri"/>
            </div>

            <div ng-show="datatype == 'Address'">


                <div class="row">
                    <div class="col-sm-1 col-md-1">
                        Use
                    </div>
                    <div class="col-sm-2 col-md-2">
                        <select ng-model="input.dt.Address.use" class="form-control">
                            <option value="home">Home</option>
                            <option value="work">Work</option>
                            <option value="temp">Temp</option>
                            <option value="old">Old</option>

                        </select>
                    </div>
                    <div class="col-sm-1 col-md-1">
                        Type
                    </div>
                    <div class="col-sm-2 col-md-2">
                        <select ng-model="input.dt.Address.type" class="form-control">
                            <option value="postal">Postal</option>
                            <option value="physical">Physical</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                </div>

                <br/>

                <div class="row">

                    <div class="col-sm-4 col-md-4">
                        <input placeholder = 'First line' type="text" class="form-control" ng-model="input.dt.Address.line1"/>
                    </div>

                    <div class="col-sm-4 col-md-4">
                        <input placeholder = 'Second line' type="text" class="form-control" ng-model="input.dt.Address.line2"/>
                    </div>

                    <div class="col-sm-4 col-md-4">
                        <input placeholder = 'Third line' type="text" class="form-control" ng-model="input.dt.Address.line3"/>
                    </div>

                </div>
                <br/>


                <div class="row">

                    <div class="col-sm-3 col-md-3">
                        <input placeholder = 'City' type="text" class="form-control" ng-model="input.dt.Address.city"/>
                    </div>

                    <div class="col-sm-3 col-md-3">
                        <input placeholder = 'District' type="text" class="form-control" ng-model="input.dt.Address.district"/>
                    </div>

                    <div class="col-sm-3 col-md-3">
                        <input placeholder = 'State' type="text" class="form-control" ng-model="input.dt.Address.state"/>
                    </div>

                    <div class="col-sm-3 col-md-3">
                        <input placeholder = 'Post code' type="text" class="form-control" ng-model="input.dt.Address.postalCode"/>
                    </div>

                </div>
                <br/>

                <div class="row">
                    <div class="col-sm-3 col-md-3">
                        <input placeholder = 'Country' type="text" class="form-control" ng-model="input.dt.Address.country"/>
                    </div>
                </div>

                <br/>

                <input placeholder = 'Enter text value of Address' type="text" class="form-control" ng-model="input.dt.Address.text"/>
            </div>

            <div ng-show="datatype == 'HumanName'">

                <div class="row">
                    <div class="col-sm-1 col-md-1">
                        Use
                    </div>
                    <div class="col-sm-2 col-md-2">
                        <select ng-model="input.dt.HumanName.use" class="form-control">
                            <option value="usual">Usual</option>
                            <option value="official">Official</option>
                            <option value="temp">Temp</option>
                            <option value="nickname">Nickname</option>
                            <option value="anonymous">Anonymous</option>
                            <option value="old">Old</option>
                            <option value="maiden">Maiden</option>
                        </select>
                    </div>
                </div>
                <br/>

                <div class="row">
                    <div class="col-sm-1 col-md-1">
                        <input placeholder = 'Pfx' type="text" class="form-control" ng-model="input.dt.HumanName.prefix"/>
                    </div>
                    <div class="col-sm-3 col-md-3">
                        <input placeholder = 'Given Name' type="text" class="form-control" ng-model="input.dt.HumanName.given"/>
                    </div>

                    <div class="col-sm-3 col-md-3">
                        <input placeholder = 'Middle' type="text" class="form-control" ng-model="input.dt.HumanName.middle"/>
                    </div>

                    <div class="col-sm-3 col-md-3">
                        <input placeholder = 'Family Name' type="text" class="form-control" ng-model="input.dt.HumanName.family"/>
                    </div>

                    <div class="col-sm-2 col-md-2">
                        <input placeholder = 'Suffix' type="text" class="form-control" ng-model="input.dt.HumanName.suffix"/>
                    </div>

                </div>



                <br/>

                <br/>
                <input placeholder = 'Text value of Name' type="text" class="form-control" ng-model="input.dt.HumanName.text"/>
            </div>

            <div ng-show="datatype == 'code'">
                <div class="row">
                    <div class="col-md-3 col-sm-3" ng-repeat = "option in expandedValueSet.expansion.contains">
                        <input type="radio" ng-model="input.dt.code" name="CodeItemName" value="{{option.code}}"  />
                        <span title="{{option.system}}">{{option.display}}</span>
                    </div>
                </div>
            </div>




            <div ng-show="datatype == 'Coding'">


                <!-- This was a small list, so completely expanded with radio buttons...-->
                <div ng-show="renderCCAsList">
                    <div class="row">
                        <div class="col-md-4 col-sm-4" ng-repeat = "option in expandedValueSet.expansion.contains">
                            <input type="radio" ng-model="input.dt.cc" name="CodingItemNme"
                                   ng-click="ccSelectedFromList(option)"

                                   value="{{option}}"  />
                            <span title="{{option.system}}">{{option.display}}</span>
                        </div>
                    </div>
                </div>

                <!-- Use a $expand lookup from the server-->
                <div ng-hide="renderCCAsList">

                    <div class="row">
                        <div class="col-sm-4 col-md-4">
                            <input placeholder="Filter text. Can be used as search text" class="form-control" ng-model="input.dt.cc.text"/>
                        </div>
                        <div class="col-sm-2 col-md-2">
                            <button ng-show="binding.url"
                                    class="btn btn-primary pull-right" ng-click="expandCC(input.dt.cc.text)">Search</button>
                        </div>

                        <div class="col-sm-6 col-md-6">
                            <div><strong>ValueSet Url:</strong> {{binding.url}}</div>
                            <div><strong>Binding: </strong>{{binding.strength}}</div>
                            <div><strong>Terminology Svr: </strong>{{termServer}}</div>
                            <!--<div><em>Click the 'Search' button to list values. If there is text in the
                            filter box, then the results are filtered by that text, otherwise all values are
                            returned (can take a while)</em></div>-->
                        </div>

                    </div>

                    <div class="row">
                        <div class="col-sm-12 col-md-12">
                            <em>Click the 'Search' button to list values. If there is text in the
                                filter box, then the results are filtered by that text, otherwise all values are
                                returned (can take a while)</em>
                        </div>

                    </div>


                    <hr/>

                    <div class="row" ng-show="selectedConceptValue">
                        <div class="col-sm-12 col-md-12 banner">

                            <strong>Selected concept</strong>
                            {{selectedConceptValue.text}} ({{selectedConceptValue.value.Coding[0].code}})
                        </div>
                    </div>

                    <!--
                                        <div id="ccGraph"></div>
                    -->
                    <div class="row" ng-show="selectedConceptProperties">
                        <div class="col-sm-6 col-md-6">
                            <strong>Parent</strong>
                            <ul class="list-unstyled">
                                <li ng-repeat="concept in selectedConceptProperties.parent">
                                    <span class="clickable" ng-click="selectConcept(concept)"> {{concept.display}}</span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-sm-6 col-md-6">
                            <strong>Children</strong>
                            <ul class="list-unstyled">
                                <li ng-repeat="concept in selectedConceptProperties.child">
                                    <span class="clickable" ng-click="selectConcept(concept)"> {{concept.display}}</span>
                                </li>
                            </ul>
                        </div>
                    </div>


                    <table class="table">
                        <tr ng-repeat="concept in expandedValueSet.expansion.contains">
                            <td><div class="clickable" ng-click="selectConcept(concept)"> {{concept.display}}</div></td>
                            <td>{{concept.code}}</td>
                            <td>{{concept.system}}</td>
                        </tr>
                    </table>
                    <!--
                    <input type="text" ng-model="input.dt.cc.coding"
                           placeholder="autocomplete from {{vsDetails.minLength}} characters"
                           typeahead-min-length="3"
                           typeahead-wait-ms="1000"
                           typeahead-on-select="selectCCfromList($item, $model, $label)"
                           uib-typeahead="opt as opt.display for opt in vsLookup($viewValue,vsUrl)"
                           class="form-control"/>

-->

                </div>

            </div>

            <div ng-show="datatype == 'CodingDEP'">

                <div ng-switch on="vsDetails.type">

                    <div ng-switch-when="list">
                        <div class="row">
                            <div class="col-md-3 col-sm-3" ng-repeat = "option in expandedValueSet.expansion.contains">
                                <input type="radio" ng-model="input.dt.coding" name="name" value="{{option}}"  />
                                <span title="{{option.system}}">{{option.display}}</span>
                            </div>
                        </div>



                        <div ng-hide="expandedValueSet.expansion.contains">
                            <div uib-alert class="alert-warning" >
                                This element is configured as a list, but there are no options. This is likely an issue
                                with the Terminology server. One possibility is that the Terminology server didn't have a chance
                                to respond with the list of options (ie it timed out), so you might want to try again.
                                <br/> <br/>
                                Sorry about that...
                            </div>
                        </div>

                    </div>
                    <div ng-switch-default>

                        <div class="row">
                            <div class="col-md-5 col-sm-5">

                                <input type="text" ng-model="input.dt.coding"
                                       placeholder="{{vsDetails.id}} (minimum {{vsDetails.minLength}} characters)"
                                       typeahead-min-length="3"
                                       typeahead-wait-ms="1000"
                                       typeahead-on-select="selectCCfromList($item, $model, $label)"
                                       uib-typeahead="opt as opt.display for opt in vsLookup($viewValue,vsDetails)"
                                       class="form-control"/>

                            </div>
                            <div class="col-md-1 col-sm-1">
                                <img ng-show='waiting' src="css/ajax_loader_blue_32.gif"/>
                            </div>
                            <div class="col-md-6 col-sm-6">
                                <div class="clickable pull-right"
                                     ng-click="showVs(vsDetails.resource)">{{vsDetails.resource.url}}</div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>

            <div ng-show="datatype == 'CodeableConcept'">

                <!-- This was a small list, so completely expanded...-->
                <div ng-show="renderCCAsList">
                    <uib-tabset>
                        <uib-tab heading="List">
                            <br/>
                            <div class="row">
                                <div class="col-md-4 col-sm-4" ng-repeat = "option in expandedValueSet.expansion.contains">
                                    <input type="radio"
                                           ng-click="ccSelectedFromList(option)"
                                           ng-model="input.dt.cc" name="ccListname" value="{{option}}"  />
                                    <span title="{{option.system}}">{{option.display}}</span>
                                </div>
                            </div>
                        </uib-tab>

                        <uib-tab heading="Json" ng-show="expandedValueSet">
                            <pre>{{expandedValueSet | json}}</pre>
                        </uib-tab>
                    </uib-tabset>

                </div>


                <div ng-hide="renderCCAsList">

                    <div class="row">
                        <div class="col-sm-4 col-md-4">
                            <input placeholder="Concept text. Can be used as search text" class="form-control" ng-model="input.dt.cc.text"/>
                        </div>
                        <div class="col-sm-2 col-md-2">
                            <button ng-show="binding.url" class="btn btn-primary pull-right"

                                    ng-click="expandCC(input.dt.cc.text)">Search</button>
                        </div>

                        <div class="col-sm-6 col-md-6">
                            <div><strong>ValueSet Url:</strong> {{binding.url}}</div>
                            <div><strong>Binding: </strong>{{binding.strength}}</div>
                            <div><strong>Terminology Svr: </strong>{{termServer}}</div>
                            <!--<div><em>Click the 'Search' button to list values. If there is text in the
                            filter box, then the results are filtered by that text, otherwise all values are
                            returned (can take a while)</em></div>-->
                        </div>

                    </div>
                    <div class="row" ng-hide="binding.url">
                        <div class="col-sm-12 col-md-12">
                            <br/>
                            <em>The underlying model has no binding to a ValueSet, so I can't do a lookup from a
                            terminology server. You can, however, enter the text value of the concept you want in the input
                                box above.</em>
                        </div>
                    </div>


                    <div class="row" ng-hide="expandedValueSet.expansion.contains || (!binding.url)">
                        <div class="col-sm-12 col-md-12">
                            <em>Click the 'Search' button to list values. If there is text in the
                                filter box, then the results are filtered by that text, otherwise all values are
                                returned (can take a while)</em>
                        </div>

                    </div>

                    <hr/>

                    <uib-tabset ng-show="binding.url">
                        <uib-tab heading="List">



                    <div class="row" ng-show="selectedConceptValue">
                        <div class="col-sm-12 col-md-12 banner">

                            <strong>Selected concept</strong>
                            {{selectedConceptValue.text}} ({{selectedConceptValue.value.Coding[0].code}})
                        </div>
                    </div>
                    <div class="row" ng-show="selectedConceptProperties">
                        <div class="col-sm-6 col-md-6">
                            <strong>Parent</strong>
                            <ul class="list-unstyled">
                                <li ng-repeat="concept in selectedConceptProperties.parent">
                                    <span class="clickable" ng-click="selectConcept(concept)"> {{concept.display}}</span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-sm-6 col-md-6">
                            <strong>Children</strong>
                            <ul class="list-unstyled">
                                <li ng-repeat="concept in selectedConceptProperties.child">
                                    <span class="clickable" ng-click="selectConcept(concept)"> {{concept.display}}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <table class="table">
                        <tr ng-repeat="concept in expandedValueSet.expansion.contains">
                            <td><div class="clickable" ng-click="selectConcept(concept)"> {{concept.display}}</div></td>
                            <td>{{concept.code}}</td>
                            <td>{{concept.system}}</td>
                        </tr>
                    </table>

                            <div ng-show="expandedValueSet.expansion.contains.length == 50">

                                <div class="alert alert-warning" style="margin: 20px">
                                    <em>Only 50 items are shown (out of a total of {{expandedValueSet.expansion.total}}). You may need to refine your search...</em>
                                </div>


                            </div>



                            <div ng-show="expandedValueSet.expansion.contains.length == 0 || expandedValueSet.expansion.total == 0">

                                <div class="alert alert-warning" style="margin: 20px">
                                    <em>There were no values returned. You may need to broaden your search...</em>
                                </div>


                            </div>



                        </uib-tab>
                        <uib-tab heading="Json" ng-show="expandedValueSet">
                            <pre>{{expandedValueSet | json}}</pre>
                        </uib-tab>
                    </uib-tabset>

<!--
                    <div class="row" ng-hide="expandedValueSet.expansion.contains">
                        <div class="col-sm-12 col-md-12">
                            <em>Click the 'Search' button to list values. If there is text in the
                                filter box, then the results are filtered by that text, otherwise all values are
                                returned (can take a while)</em>
                        </div>

                    </div>
                    -->
                </div>

            </div>



            <div ng-show="ooError">
                <div class="alert alert-danger" style="margin: 20px">
                    <div ng-repeat="iss in ooError.issue">
                        Error from terminology server: {{iss.details.text}} {{iss.diagnostics}}
                    </div>
                </div>


            </div>





        </div>

    </div>

    <div class="modal-header">
        <hr/>
        <em>Note that this <strong>may</strong> correctly show the existing value for this element, but may not
        be or may be incomplete. Working on it...</em>
        <div class="row">
            <div class="col-md-6 col-sm-6">
                <div><strong>Scenario</strong></div>
                <p ng-bind-html="scenario.description | markDown"></p>


            </div>
            <div class="col-md-6 col-sm-6">
                <div><strong>This element</strong></div>
                <p>{{row.definition}}</p>

            </div>




        </div>
    </div>
</div>